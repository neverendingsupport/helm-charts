{{- if .Values.fieldExport.enabled }}
{{- $domainName := default (include "ack-opensearch-provider.fullname" .) .Values.domain.name }}
{{- $secretName := include "ack-opensearch-provider.connectionSecretName" . }}
{{- range $idx, $mapping := .Values.fieldExport.mappings }}
---
apiVersion: services.k8s.aws/v1alpha1
kind: FieldExport
metadata:
  name: {{ printf "%s-%s" (include "ack-opensearch-provider.fullname" $) $mapping.name | trunc 63 | trimSuffix "-" }}
  labels:
    {{- include "ack-opensearch-provider.labels" $ | nindent 4 }}
spec:
  from:
    path: {{ $mapping.path | quote }}
    resource:
      group: opensearchservice.services.k8s.aws
      kind: Domain
      name: {{ $domainName }}
  to:
    kind: secret
    name: {{ $secretName }}
    key: {{ $mapping.key }}
{{- end }}
{{- end }}
